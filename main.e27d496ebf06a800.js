"use strict";(self.webpackChunkangular_SIMAt=self.webpackChunkangular_SIMAt||[]).push([[179],{7574:(g,h,t)=>{t.d(h,{a:()=>l});var a=t(5e3),n=t(629),p=t(6696);let l=(()=>{class o{constructor(i,A){this._authService=i,this._router=A}canActivate(){return!!this._authService.isLoggedIn||(this._router.navigate(["/login"]),!1)}canLoad(){return!!this._authService.isLoggedIn||(this._router.navigate(["/login"]),!1)}}return o.\u0275fac=function(i){return new(i||o)(a.LFG(n.e),a.LFG(p.F0))},o.\u0275prov=a.Yz7({token:o,factory:o.\u0275fac,providedIn:"root"}),o})()},8042:(g,h,t)=>{t.d(h,{i:()=>l});var a=t(5e3),n=t(629),p=t(6696);let l=(()=>{class o{constructor(i,A){this._authService=i,this._router=A}canActivate(){return!this._authService.isLoggedIn||(this._router.navigate(["/app/home"]),!1)}canLoad(){return!this._authService.isLoggedIn||(this._router.navigate(["/app/home"]),!1)}}return o.\u0275fac=function(i){return new(i||o)(a.LFG(n.e),a.LFG(p.F0))},o.\u0275prov=a.Yz7({token:o,factory:o.\u0275fac,providedIn:"root"}),o})()},7793:(g,h,t)=>{t.d(h,{r:()=>e});var a=t(2340),n=t(5e3),p=t(520),l=t(629),o=t(704);let e=(()=>{class i{constructor(u,v,m){this._http=u,this._authService=v,this._alertService=m}login(u){return new Promise((v,m)=>{if("alvin"!==u.username.toLowerCase()&&"putra"!==u.username.toLowerCase()&&"demo"!==u.username.toLowerCase())return this._alertService.alert("warning","Warning",'Silahkan akses <a href="https://mobile-presensi.ypsimlibrary.com">https://mobile-presensi.ypsimlibrary.com</a>!'),void v(null);this._http.post(`${a.N.apiUrl}/login`,u,{responseType:"json"}).subscribe({next:f=>{const S=f.Result;S.Data.username=u.username,S.Data.password=u.password,this._authService.updateToken(S.AccessToken),this._authService.updateUserData(S.Data),v(S)},error:f=>{var S;return m(null!==(S=f.error)&&void 0!==S?S:f)},complete:()=>{}})})}register(u){return new Promise((v,m)=>{this._http.post(`${a.N.apiUrl}/register`,u,{responseType:"json"}).subscribe({next:f=>v(f.Result),error:f=>m(f.error),complete:()=>{}})})}logout(){return new Promise((u,v)=>{this._http.post(`${a.N.apiUrl}/logout`,null,{responseType:"json"}).subscribe({next:m=>u(m),error:m=>v(m.error),complete:()=>{this._authService.reset()}})})}}return i.\u0275fac=function(u){return new(u||i)(n.LFG(p.eN),n.LFG(l.e),n.LFG(o.c))},i.\u0275prov=n.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),i})()},704:(g,h,t)=>{t.d(h,{c:()=>l});var a=t(5226),n=t.n(a),p=t(5e3);let l=(()=>{class o{alert(i,A,u){return n().fire({icon:i,title:A,html:u})}}return o.\u0275fac=function(i){return new(i||o)},o.\u0275prov=p.Yz7({token:o,factory:o.\u0275fac,providedIn:"root"}),o})()},629:(g,h,t)=>{t.d(h,{e:()=>p});var a=t(1135),n=t(5e3);let p=(()=>{class l{constructor(){this.TokenSubject=new a.X(null),this.UserSubject=new a.X(null),this.retrieveToken(),this.retrieveUserData()}get token$(){return this.TokenSubject.asObservable()}get userId(){var e;return(null===(e=this.getUserData())||void 0===e?void 0:e.id)||null}getAuthToken(){var e;return null!==(e=this.TokenSubject.value)&&void 0!==e?e:this.retrieveToken()}getUserData(){var e;return null!==(e=this.UserSubject.value)&&void 0!==e?e:this.retrieveUserData()}updateToken(e){e?localStorage.setItem("AccessToken",e):localStorage.removeItem("AccessToken"),this.TokenSubject.next(e)}retrieveToken(){const e=localStorage.getItem("AccessToken");return this.updateToken(e),e}updateUserData(e){localStorage.setItem("user_data",JSON.stringify(e)),this.UserSubject.next(e)}retrieveUserData(){const e=localStorage.getItem("user_data")?JSON.parse(localStorage.getItem("user_data")):null;return this.UserSubject.next(e),e}getSavedCredentials(){if(this.getUserData()){const{username:e,password:i}=this.getUserData();return{username:e,password:i}}return null}get isLoggedIn(){return null!==this.TokenSubject.value}reset(){this.UserSubject.next(null),this.TokenSubject.next(null),localStorage.removeItem("AccessToken"),localStorage.removeItem("user_data")}}return l.\u0275fac=function(e){return new(e||l)},l.\u0275prov=n.Yz7({token:l,factory:l.\u0275fac,providedIn:"root"}),l})()},2340:(g,h,t)=>{t.d(h,{N:()=>a});const a={production:!0,apiUrl:"https://staging-presensi.ypsimlibrary.com/api",url:"https://staging-presensi.ypsimlibrary.com"}},6728:(g,h,t)=>{var a=t(2313),n=t(5e3),p=t(9808),l=t(520),o=t(1271),e=t(6360),i=t(6165),A=t(8077),u=t(2340),v=t(6696),m=t(7574);const S=[{path:"",pathMatch:"full",redirectTo:"app"},{path:"login",canLoad:[t(8042).i],loadChildren:()=>Promise.all([t.e(346),t.e(531),t.e(585)]).then(t.bind(t,5585)).then(r=>r.LoginModule)},{path:"app",canLoad:[m.a],loadChildren:()=>Promise.all([t.e(346),t.e(531),t.e(842),t.e(40)]).then(t.bind(t,4040)).then(r=>r.LayoutModule)},{path:"camera",loadChildren:()=>Promise.all([t.e(346),t.e(842),t.e(209)]).then(t.bind(t,209)).then(r=>r.CameraModule)}];let D=(()=>{class r{}return r.\u0275fac=function(s){return new(s||r)},r.\u0275mod=n.oAB({type:r}),r.\u0275inj=n.cJS({imports:[[v.Bz.forRoot(S,{useHash:!0,preloadingStrategy:v.wm})],v.Bz]}),r})();var P=t(7445);let U=(()=>{class r{constructor(s,d){this.swUpdate=s,this.ngZone=d,this.title="angular-SIMAt",s.isEnabled&&this.ngZone.runOutsideAngular(()=>(0,P.F)(15e3).subscribe(c=>{s.checkForUpdate().then(I=>{this.swUpdate.activateUpdate().then(()=>document.location.reload())})}))}ngOnInit(){}}return r.\u0275fac=function(s){return new(s||r)(n.Y36(i.yO),n.Y36(n.R0b))},r.\u0275cmp=n.Xpm({type:r,selectors:[["app-root"]],decls:1,vars:0,template:function(s,d){1&s&&n._UZ(0,"router-outlet")},directives:[v.lC],styles:[""]}),r})();var T=t(2843),O=t(2076),L=t(3900),C=t(9300),y=t(5698),M=t(262),F=t(629),j=t(7793);let R=(()=>{class r{constructor(s,d,c){this._authService=s,this._router=d,this._loginService=c,this.reloginInProgress=!1}injectToken(s,d){const c=d||this._authService.getAuthToken();return s.clone({setHeaders:{Authorization:`Bearer ${c}`}})}handleUnauthorized(s,d){if(this.reloginInProgress)return this._authService.token$.pipe((0,C.h)(c=>null!==c),(0,y.q)(1),(0,L.w)(c=>d.handle(this.injectToken(s,c)).pipe((0,M.K)(I=>(0,T._)(()=>I)))));{this.reloginInProgress=!0,this._authService.updateToken(null);const c=this._authService.getSavedCredentials();return c?(0,O.D)(this._loginService.login(c)).pipe((0,L.w)(()=>d.handle(this.injectToken(s)))):(this._authService.reset(),this._router.navigateByUrl("/login"),(0,T._)(()=>"Token expired"))}}intercept(s,d){return this._authService.isLoggedIn?d.handle(this.injectToken(s)).pipe((0,M.K)(c=>c instanceof l.UA&&401===c.status?this.handleUnauthorized(s,d):(0,T._)(()=>c))):d.handle(s)}}return r.\u0275fac=function(s){return new(s||r)(n.LFG(F.e),n.LFG(v.F0),n.LFG(j.r))},r.\u0275prov=n.Yz7({token:r,factory:r.\u0275fac}),r})(),B=(()=>{class r{}return r.\u0275fac=function(s){return new(s||r)},r.\u0275mod=n.oAB({type:r,bootstrap:[U]}),r.\u0275inj=n.cJS({providers:[p.uU,{provide:l.TP,useClass:R,multi:!0}],imports:[[a.b2,D,A.IJ,e.PW,i.Wr.register("ngsw-worker.js",{enabled:u.N.production,registrationStrategy:"registerWhenStable:30000"}),l.JF,o.ZX]]}),r})();u.N.production&&(0,n.G48)(),a.q6().bootstrapModule(B).then(()=>{"serviceWorker"in navigator&&u.N.production&&navigator.serviceWorker.register("ngsw-worker.js")}).catch(r=>console.error(r))}},g=>{g.O(0,[736],()=>g(g.s=6728)),g.O()}]);