"use strict";(self.webpackChunkangular_SIMAt=self.webpackChunkangular_SIMAt||[]).push([[179],{7574:(f,h,t)=>{t.d(h,{a:()=>u});var s=t(5e3),n=t(629),m=t(6696);let u=(()=>{class o{constructor(i,A){this._authService=i,this._router=A}canActivate(){return!!this._authService.isLoggedIn||(this._router.navigate(["/login"]),!1)}canLoad(){return!!this._authService.isLoggedIn||(this._router.navigate(["/login"]),!1)}}return o.\u0275fac=function(i){return new(i||o)(s.LFG(n.e),s.LFG(m.F0))},o.\u0275prov=s.Yz7({token:o,factory:o.\u0275fac,providedIn:"root"}),o})()},8042:(f,h,t)=>{t.d(h,{i:()=>u});var s=t(5e3),n=t(629),m=t(6696);let u=(()=>{class o{constructor(i,A){this._authService=i,this._router=A}canActivate(){return!this._authService.isLoggedIn||(this._router.navigate(["/app/home"]),!1)}canLoad(){return!this._authService.isLoggedIn||(this._router.navigate(["/app/home"]),!1)}}return o.\u0275fac=function(i){return new(i||o)(s.LFG(n.e),s.LFG(m.F0))},o.\u0275prov=s.Yz7({token:o,factory:o.\u0275fac,providedIn:"root"}),o})()},7793:(f,h,t)=>{t.d(h,{r:()=>e});var s=t(2340),n=t(5e3),m=t(520),u=t(629),o=t(704);let e=(()=>{class i{constructor(c,v,g){this._http=c,this._authService=v,this._alertService=g}login(c){return new Promise((v,g)=>{this._http.post(`${s.N.apiUrl}/login`,c,{responseType:"json"}).subscribe({next:S=>{const p=S.Result;null!==p.Data?(p.Data.username=c.username,p.Data.password=c.password,this._authService.updateToken(p.AccessToken),this._authService.updateUserData(p.Data),v(p)):g("Data user kosong! Silahkan cek tipe akun user")},error:S=>{var p;return g(null!==(p=S.error)&&void 0!==p?p:S)},complete:()=>{}})})}register(c){return new Promise((v,g)=>{this._http.post(`${s.N.apiUrl}/register`,c,{responseType:"json"}).subscribe({next:S=>v(S.Result),error:S=>g(S.error),complete:()=>{}})})}logout(){return new Promise((c,v)=>{this._http.post(`${s.N.apiUrl}/logout`,null,{responseType:"json"}).subscribe({next:g=>c(g),error:g=>v(g.error),complete:()=>{this._authService.reset()}})})}}return i.\u0275fac=function(c){return new(c||i)(n.LFG(m.eN),n.LFG(u.e),n.LFG(o.c))},i.\u0275prov=n.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),i})()},704:(f,h,t)=>{t.d(h,{c:()=>u});var s=t(5226),n=t.n(s),m=t(5e3);let u=(()=>{class o{alert(i,A,c){return n().fire({icon:i,title:A,html:c})}}return o.\u0275fac=function(i){return new(i||o)},o.\u0275prov=m.Yz7({token:o,factory:o.\u0275fac,providedIn:"root"}),o})()},629:(f,h,t)=>{t.d(h,{e:()=>m});var s=t(1135),n=t(5e3);let m=(()=>{class u{constructor(){this.TokenSubject=new s.X(null),this.UserSubject=new s.X(null),this.retrieveToken(),this.retrieveUserData()}get token$(){return this.TokenSubject.asObservable()}get userId(){var e;return(null===(e=this.getUserData())||void 0===e?void 0:e.id)||null}getAuthToken(){var e;return null!==(e=this.TokenSubject.value)&&void 0!==e?e:this.retrieveToken()}getUserData(){var e;return null!==(e=this.UserSubject.value)&&void 0!==e?e:this.retrieveUserData()}updateToken(e){e?localStorage.setItem("AccessToken",e):localStorage.removeItem("AccessToken"),this.TokenSubject.next(e)}retrieveToken(){const e=localStorage.getItem("AccessToken");return this.updateToken(e),e}updateUserData(e){localStorage.setItem("user_data",JSON.stringify(e)),this.UserSubject.next(e)}retrieveUserData(){const e=localStorage.getItem("user_data")?JSON.parse(localStorage.getItem("user_data")):null;return this.UserSubject.next(e),e}getSavedCredentials(){if(this.getUserData()){const{username:e,password:i}=this.getUserData();return{username:e,password:i}}return null}get isLoggedIn(){return null!==this.TokenSubject.value}reset(){this.UserSubject.next(null),this.TokenSubject.next(null),localStorage.removeItem("AccessToken"),localStorage.removeItem("user_data")}}return u.\u0275fac=function(e){return new(e||u)},u.\u0275prov=n.Yz7({token:u,factory:u.\u0275fac,providedIn:"root"}),u})()},2340:(f,h,t)=>{t.d(h,{N:()=>s});const s={production:!0,apiUrl:"https://staging-presensi.ypsimlibrary.com/api",url:"https://staging-presensi.ypsimlibrary.com"}},6728:(f,h,t)=>{var s=t(2313),n=t(5e3),m=t(9808),u=t(520),o=t(1271),e=t(6360),i=t(6165),A=t(8077),c=t(2340),v=t(6696),g=t(7574);const p=[{path:"",pathMatch:"full",redirectTo:"app"},{path:"login",canLoad:[t(8042).i],loadChildren:()=>Promise.all([t.e(346),t.e(531),t.e(585)]).then(t.bind(t,5585)).then(r=>r.LoginModule)},{path:"app",canLoad:[g.a],loadChildren:()=>Promise.all([t.e(346),t.e(531),t.e(842),t.e(40)]).then(t.bind(t,4040)).then(r=>r.LayoutModule)},{path:"camera",loadChildren:()=>Promise.all([t.e(346),t.e(842),t.e(209)]).then(t.bind(t,209)).then(r=>r.CameraModule)}];let L=(()=>{class r{}return r.\u0275fac=function(a){return new(a||r)},r.\u0275mod=n.oAB({type:r}),r.\u0275inj=n.cJS({imports:[[v.Bz.forRoot(p,{useHash:!0,preloadingStrategy:v.wm})],v.Bz]}),r})();var P=t(7445);let U=(()=>{class r{constructor(a,d){this.swUpdate=a,this.ngZone=d,this.title="angular-SIMAt",a.isEnabled&&window.navigator&&navigator.serviceWorker&&navigator.serviceWorker.getRegistrations().then(function(l){for(let T of l)T.unregister()}).finally(()=>{navigator.serviceWorker.register("ngsw-worker.js"),this.ngZone.runOutsideAngular(()=>(0,P.F)(6e4).subscribe(l=>{a.checkForUpdate().then(T=>{T&&this.swUpdate.activateUpdate().then(()=>document.location.reload())})}))})}ngOnInit(){}}return r.\u0275fac=function(a){return new(a||r)(n.Y36(i.yO),n.Y36(n.R0b))},r.\u0275cmp=n.Xpm({type:r,selectors:[["app-root"]],decls:1,vars:0,template:function(a,d){1&a&&n._UZ(0,"router-outlet")},directives:[v.lC],styles:[""]}),r})();var D=t(2843),O=t(2076),I=t(3900),y=t(9300),C=t(5698),M=t(262),F=t(629),R=t(7793);let j=(()=>{class r{constructor(a,d,l){this._authService=a,this._router=d,this._loginService=l,this.reloginInProgress=!1}injectToken(a,d){const l=d||this._authService.getAuthToken();return a.clone({setHeaders:{Authorization:`Bearer ${l}`}})}handleUnauthorized(a,d){if(this.reloginInProgress)return this._authService.token$.pipe((0,y.h)(l=>null!==l),(0,C.q)(1),(0,I.w)(l=>d.handle(this.injectToken(a,l)).pipe((0,M.K)(T=>(0,D._)(()=>T)))));{this.reloginInProgress=!0,this._authService.updateToken(null);const l=this._authService.getSavedCredentials();return l?(0,O.D)(this._loginService.login(l)).pipe((0,I.w)(()=>d.handle(this.injectToken(a)))):(this._authService.reset(),this._router.navigateByUrl("/login"),(0,D._)(()=>"Token expired"))}}intercept(a,d){return this._authService.isLoggedIn?d.handle(this.injectToken(a)).pipe((0,M.K)(l=>l instanceof u.UA&&401===l.status?this.handleUnauthorized(a,d):(0,D._)(()=>l))):d.handle(a)}}return r.\u0275fac=function(a){return new(a||r)(n.LFG(F.e),n.LFG(v.F0),n.LFG(R.r))},r.\u0275prov=n.Yz7({token:r,factory:r.\u0275fac}),r})(),B=(()=>{class r{}return r.\u0275fac=function(a){return new(a||r)},r.\u0275mod=n.oAB({type:r,bootstrap:[U]}),r.\u0275inj=n.cJS({providers:[m.uU,{provide:u.TP,useClass:j,multi:!0}],imports:[[s.b2,L,A.IJ,e.PW,i.Wr.register("ngsw-worker.js",{enabled:c.N.production,registrationStrategy:"registerWhenStable:30000"}),u.JF,o.ZX]]}),r})();c.N.production&&(0,n.G48)(),s.q6().bootstrapModule(B).then(()=>{}).catch(r=>console.error(r))}},f=>{f.O(0,[736],()=>f(f.s=6728)),f.O()}]);