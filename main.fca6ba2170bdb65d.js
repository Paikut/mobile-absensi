"use strict";(self.webpackChunkangular_SIMAt=self.webpackChunkangular_SIMAt||[]).push([[179],{7574:(d,c,t)=>{t.d(c,{a:()=>l});var s=t(5e3),o=t(629),g=t(6696);let l=(()=>{class n{constructor(a,A){this._authService=a,this._router=A}canActivate(){return!!this._authService.isLoggedIn||(this._router.navigate(["/login"]),!1)}canLoad(){return!!this._authService.isLoggedIn||(this._router.navigate(["/login"]),!1)}}return n.\u0275fac=function(a){return new(a||n)(s.LFG(o.e),s.LFG(g.F0))},n.\u0275prov=s.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"}),n})()},8042:(d,c,t)=>{t.d(c,{i:()=>l});var s=t(5e3),o=t(629),g=t(6696);let l=(()=>{class n{constructor(a,A){this._authService=a,this._router=A}canActivate(){return!this._authService.isLoggedIn||(this._router.navigate(["/app/home"]),!1)}canLoad(){return!this._authService.isLoggedIn||(this._router.navigate(["/app/home"]),!1)}}return n.\u0275fac=function(a){return new(a||n)(s.LFG(o.e),s.LFG(g.F0))},n.\u0275prov=s.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"}),n})()},7793:(d,c,t)=>{t.d(c,{r:()=>e});var s=t(2340),o=t(5e3),g=t(520),l=t(629),n=t(704);let e=(()=>{class a{constructor(u,h,p){this._http=u,this._authService=h,this._alertService=p}login(u){return new Promise((h,p)=>{if("alvin"!==u.username.toLowerCase()&&"putra"!==u.username.toLowerCase()&&"demo"!==u.username.toLowerCase())return this._alertService.alert("warning","Warning",'Silahkan akses <a href="https://mobile-presensi.ypsimlibrary.com">https://mobile-presensi.ypsimlibrary.com</a>!'),void h(null);this._http.post(`${s.N.apiUrl}/login`,u,{responseType:"json"}).subscribe({next:f=>{const m=f.Result;m.Data.username=u.username,m.Data.password=u.password,this._authService.updateToken(m.AccessToken),this._authService.updateUserData(m.Data),h(m)},error:f=>{var m;return p(null!==(m=f.error)&&void 0!==m?m:f)},complete:()=>{}})})}register(u){return new Promise((h,p)=>{this._http.post(`${s.N.apiUrl}/register`,u,{responseType:"json"}).subscribe({next:f=>h(f.Result),error:f=>p(f.error),complete:()=>{}})})}logout(){return new Promise((u,h)=>{this._http.post(`${s.N.apiUrl}/logout`,null,{responseType:"json"}).subscribe({next:p=>u(p),error:p=>h(p.error),complete:()=>{this._authService.reset()}})})}}return a.\u0275fac=function(u){return new(u||a)(o.LFG(g.eN),o.LFG(l.e),o.LFG(n.c))},a.\u0275prov=o.Yz7({token:a,factory:a.\u0275fac,providedIn:"root"}),a})()},704:(d,c,t)=>{t.d(c,{c:()=>l});var s=t(5226),o=t.n(s),g=t(5e3);let l=(()=>{class n{alert(a,A,u){return o().fire({icon:a,title:A,html:u})}}return n.\u0275fac=function(a){return new(a||n)},n.\u0275prov=g.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"}),n})()},629:(d,c,t)=>{t.d(c,{e:()=>g});var s=t(1135),o=t(5e3);let g=(()=>{class l{constructor(){this.TokenSubject=new s.X(null),this.UserSubject=new s.X(null),this.retrieveToken(),this.retrieveUserData()}get token$(){return this.TokenSubject.asObservable()}get userId(){var e;return(null===(e=this.getUserData())||void 0===e?void 0:e.id)||null}getAuthToken(){var e;return null!==(e=this.TokenSubject.value)&&void 0!==e?e:this.retrieveToken()}getUserData(){var e;return null!==(e=this.UserSubject.value)&&void 0!==e?e:this.retrieveUserData()}updateToken(e){e?localStorage.setItem("AccessToken",e):localStorage.removeItem("AccessToken"),this.TokenSubject.next(e)}retrieveToken(){const e=localStorage.getItem("AccessToken");return this.updateToken(e),e}updateUserData(e){localStorage.setItem("user_data",JSON.stringify(e)),this.UserSubject.next(e)}retrieveUserData(){const e=localStorage.getItem("user_data")?JSON.parse(localStorage.getItem("user_data")):null;return this.UserSubject.next(e),e}getSavedCredentials(){if(this.getUserData()){const{username:e,password:a}=this.getUserData();return{username:e,password:a}}return null}get isLoggedIn(){return null!==this.TokenSubject.value}reset(){this.UserSubject.next(null),this.TokenSubject.next(null),localStorage.removeItem("AccessToken"),localStorage.removeItem("user_data")}}return l.\u0275fac=function(e){return new(e||l)},l.\u0275prov=o.Yz7({token:l,factory:l.\u0275fac,providedIn:"root"}),l})()},2340:(d,c,t)=>{t.d(c,{N:()=>s});const s={production:!0,apiUrl:"https://staging-presensi.ypsimlibrary.com/api",url:"https://staging-presensi.ypsimlibrary.com"}},6728:(d,c,t)=>{var s=t(2313),o=t(5e3),g=t(9808),l=t(520),n=t(1271),e=t(6360),a=t(6165),A=t(8077),u=t(2340),h=t(6696),p=t(7574);const m=[{path:"",pathMatch:"full",redirectTo:"app"},{path:"login",canLoad:[t(8042).i],loadChildren:()=>Promise.all([t.e(346),t.e(531),t.e(585)]).then(t.bind(t,5585)).then(r=>r.LoginModule)},{path:"app",canLoad:[p.a],loadChildren:()=>Promise.all([t.e(346),t.e(531),t.e(842),t.e(40)]).then(t.bind(t,4040)).then(r=>r.LayoutModule)},{path:"camera",loadChildren:()=>Promise.all([t.e(346),t.e(842),t.e(209)]).then(t.bind(t,209)).then(r=>r.CameraModule)}];let D=(()=>{class r{}return r.\u0275fac=function(i){return new(i||r)},r.\u0275mod=o.oAB({type:r}),r.\u0275inj=o.cJS({imports:[[h.Bz.forRoot(m,{useHash:!0,preloadingStrategy:h.wm})],h.Bz]}),r})(),P=(()=>{class r{constructor(){this.title="angular-SIMAt"}ngOnInit(){}}return r.\u0275fac=function(i){return new(i||r)},r.\u0275cmp=o.Xpm({type:r,selectors:[["app-root"]],decls:1,vars:0,template:function(i,S){1&i&&o._UZ(0,"router-outlet")},directives:[h.lC],styles:[""]}),r})();var E=t(2843),U=t(2076),I=t(3900),O=t(9300),C=t(5698),L=t(262),y=t(629),F=t(7793);let j=(()=>{class r{constructor(i,S,v){this._authService=i,this._router=S,this._loginService=v,this.reloginInProgress=!1}injectToken(i,S){const v=S||this._authService.getAuthToken();return i.clone({setHeaders:{Authorization:`Bearer ${v}`}})}handleUnauthorized(i,S){if(this.reloginInProgress)return this._authService.token$.pipe((0,O.h)(v=>null!==v),(0,C.q)(1),(0,I.w)(v=>S.handle(this.injectToken(i,v)).pipe((0,L.K)(M=>(0,E._)(()=>M)))));{this.reloginInProgress=!0,this._authService.updateToken(null);const v=this._authService.getSavedCredentials();return v?(0,U.D)(this._loginService.login(v)).pipe((0,I.w)(()=>S.handle(this.injectToken(i)))):(this._authService.reset(),this._router.navigateByUrl("/login"),(0,E._)(()=>"Token expired"))}}intercept(i,S){return this._authService.isLoggedIn?S.handle(this.injectToken(i)).pipe((0,L.K)(v=>v instanceof l.UA&&401===v.status?this.handleUnauthorized(i,S):(0,E._)(()=>v))):S.handle(i)}}return r.\u0275fac=function(i){return new(i||r)(o.LFG(y.e),o.LFG(h.F0),o.LFG(F.r))},r.\u0275prov=o.Yz7({token:r,factory:r.\u0275fac}),r})(),B=(()=>{class r{}return r.\u0275fac=function(i){return new(i||r)},r.\u0275mod=o.oAB({type:r,bootstrap:[P]}),r.\u0275inj=o.cJS({providers:[g.uU,{provide:l.TP,useClass:j,multi:!0}],imports:[[s.b2,D,A.IJ,e.PW,a.Wr.register("ngsw-worker.js",{enabled:u.N.production,registrationStrategy:"registerWhenStable:30000"}),l.JF,n.ZX]]}),r})();u.N.production&&(0,o.G48)(),s.q6().bootstrapModule(B).catch(r=>console.error(r))}},d=>{d.O(0,[736],()=>d(d.s=6728)),d.O()}]);